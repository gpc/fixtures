<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>2. Defining The Data</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    <h1><a name="2. Defining The Data">2. Defining The Data</a></h1>Fixture data is defined using a simple DSL that expresses objects, their properties and their relationships. This is the same DSL used by Grails' <a href=":http://grails.org/doc/latest/guide/14.%20Grails%20and%20Spring.html#14.4%20The%20BeanBuilder%20DSL%20Explained">Spring BeanBuilder</a> as underneath the covers a BeanBuilder is being used to create the fixture data.<p class="paragraph"/>See the section on <a href="../guide/single.html#3. Loading Fixtures" class="guide">loading data</a> for information on how to load these definitions.<p class="paragraph"/>Here is an overview of the DSL, focussing on features useful for fixture definition.<h2><a name="2.1 Basics">2.1 Basics</a></h2>A single object is defined as follows...<p class="paragraph"/><div class="code"><pre>gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>)</pre></div><p class="paragraph"/>This is defining an object named <code>gina</code>, of type <code>Book</code> with the <code>title</code> property set to <code>"Groovy In Action"</code>.<p class="paragraph"/>An alternative syntax is...<p class="paragraph"/><div class="code"><pre>gina(Book) &#123;
    title =  <span class="java&#45;quote">"Groovy In Action"</span>
&#125;</pre></div><p class="paragraph"/>These two syntaxes effectively achieve the same thing. The difference is that the first example is equivalent to...<p class="paragraph"/><div class="code"><pre>def gina = <span class="java&#45;keyword">new</span> Book(title: <span class="java&#45;quote">"Groovy In Action"</span>)</pre></div><p class="paragraph"/>While the second (alternative) syntax is equivalent to...<p class="paragraph"/><div class="code"><pre>def gina = <span class="java&#45;keyword">new</span> Book()
gina.title = <span class="java&#45;quote">"Groovy In Action"</span></pre></div><p class="paragraph"/>The two can even be mixed...<p class="paragraph"/><div class="code"><pre>gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>) &#123;
    isbn = <span class="java&#45;quote">"123456778"</span>
&#125;</pre></div><p class="paragraph"/><h4>Specifying Relationships</h4><p class="paragraph"/>A key benefit to using the fixtures plugin is that it makes specifying related objects simple and concise.<p class="paragraph"/>Consider the following GORM domain classes:<p class="paragraph"/><div class="code"><pre>class Author &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;
    <span class="java&#45;object">String</span> name
&#125;
class Book &#123;
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/>We can specify an Author/Book relationship like so...<p class="paragraph"/><div class="code"><pre>b(Book, title: <span class="java&#45;quote">"The Fellowship of the Ring"</span>)
a(Author, name: <span class="java&#45;quote">"J.R.R. Tolkien"</span>, books: &#91;b&#93;)</pre></div><p class="paragraph"/>In this example, <code>b</code> must be defined before it is referenced by <code>a</code>. To reference <code>b</code> before it is defined, the special <code>ref(«name»)</code> method can be used...<p class="paragraph"/><div class="code"><pre>a(Author, name: <span class="java&#45;quote">"J.R.R. Tolkien"</span>, books: &#91;ref(<span class="java&#45;quote">"b"</span>)&#93;)
b(Book, title: <span class="java&#45;quote">"The Fellowship of the Ring"</span>)</pre></div><p class="paragraph"/>If the relationship is bidirectional, it can be set on either side...<p class="paragraph"/><div class="code"><pre>a(Author, name: <span class="java&#45;quote">"J.R.R. Tolkien"</span>)
b(Book, title: <span class="java&#45;quote">"The Fellowship of the Ring"</span>, author: a)</pre></div><p class="paragraph"/><h2><a name="2.2 Build-Test-Data Integration">2.2 Build-Test-Data Integration</a></h2>The <a href="http://www.grails.org/plugin/build-test-data" target="blank">build-test-data plugin</a> is a great plugin that simplifies specifying test data by populating required properties for you that you don't care about in your particular test.<p class="paragraph"/>Consider the following class...<p class="paragraph"/><div class="code"><pre>// Book.groovy
class Book &#123;
  <span class="java&#45;object">String</span> title
  <span class="java&#45;object">String</span> isbn<p class="paragraph"/>  <span class="java&#45;keyword">static</span> constraints = &#123;
    title(required: <span class="java&#45;keyword">true</span>)
    isbn(required: <span class="java&#45;keyword">true</span>)
  &#125;
&#125;</pre></div><p class="paragraph"/>Whenever an instance of Book is created for a test, the <code>isbn</code> property has to be populated for the object to pass validation which can be distracting if your test does not care about the <code>isbn</code> property. The build-test-data plugin provides a static <code>build()</code> method on all domain classes that creates an instance with all non-specified, mandatory properties filled in with placeholder values that pass constrain tests. For more information, see the documentation on the plugin.<p class="paragraph"/>The fixtures plugin integrates with build-test-data by providing a <code>build()</code> method that has the same behaviour as <code>load()</code> except that objects are created via the build-test-data static <code>build()</code> method.<p class="paragraph"/>Which means that the following test will pass...<p class="paragraph"/><div class="code"><pre>def fixture = fixtureLoader.build &#123;
  gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>)
&#125;
assert fixture.gina.isbn != <span class="java&#45;keyword">null</span></pre></div><p class="paragraph"/>And is equivalent to...<p class="paragraph"/><div class="code"><pre>def gina = Book.build(title: <span class="java&#45;quote">"Groovy In Action"</span>)
assert gina.isbn != <span class="java&#45;keyword">null</span></pre></div><p class="paragraph"/>In fixture files, you can specify that build-test-data integration should be used by using the <code>build()</code> method instead of the usual <code>fixture()</code> method.<p class="paragraph"/><h4>Switching it on/off</h4><p class="paragraph"/>You may only want to define part of your fixture with build-test-data integration, or conversely you may want to define part of it without it. You can do this via the <code>build()</code> and <code>noBuild()</code> methods inside a fixture definition.<p class="paragraph"/><div class="code"><pre>fixtureLoader.load &#123;
  build &#123;
    gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>)
  &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>fixtureLoader.build &#123;
  noBuild &#123;
    gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>, isbn: <span class="java&#45;quote">"12345678"</span>)
  &#125;
&#125;</pre></div><p class="paragraph"/><h4>Installing build-test-data</h4><p class="paragraph"/>Note that build-test-data integration only works if you have installed the build-test-data plugin yourself. The fixtures plugin does not attempt to install it for you.

    </body>
</html>
