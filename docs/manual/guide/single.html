<html>
	<head>
		  <title>Grails Fixtures Plugin 1.0.RC1.SNAPSHOT - Reference Documentation</title>
		  <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Style" charset="utf-8">	
	</head>
    <body class="body">
		<div id="header">
				<div class="images"><br><br>
				   <a href="http://grails.org"  target="_blank"><img alt="The Grails Framework" src="../img/grails.png" border="0"></a>
				   <span style="right:30px; top:20px; position:absolute;">
					<a href="../index.html" target="_top">Frames</a> | <a href="index.html" target="_top">No Frames</a><br><br>
                     <a alt="SpringSource - A Division of VMware" href="http://springsource.com" target="_blank"><img src="../img/springsource-logo.png" border="0"></a>					
					</span>					
				</div>
				<div class="message">Load complex domain data via a convenient DSL</div>
				<h1>Grails Fixtures Plugin - Reference Documentation</h1>
				<p><strong>Authors:</strong> Grails Plugin Collective</p>
				<p><strong>Version:</strong> 1.0.RC1.SNAPSHOT</p>				
				<em>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</em>
		</div>                       
		
		<div id="toc">  
			<h2>Table of Contents</h2>
			<div class="tocItem" style="margin-left:0px"><a href="#1. Introduction">1. Introduction</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.1 How It Works">1.1 How It Works</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.2 Changelog">1.2 Changelog</a></div><div class="tocItem" style="margin-left:0px"><a href="#2. Defining The Data">2. Defining The Data</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.1 Basics">2.1 Basics</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.2 Advanced Techniques">2.2 Advanced Techniques</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.3 Build-Test-Data Integration">2.3 Build-Test-Data Integration</a></div><div class="tocItem" style="margin-left:0px"><a href="#3. Loading Fixtures">3. Loading Fixtures</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.1 Inline Fixtures">3.1 Inline Fixtures</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.2 Fixture Files">3.2 Fixture Files</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.3 Named Fixtures">3.3 Named Fixtures</a></div><div class="tocItem" style="margin-left:0px"><a href="#4. Fixture Objects">4. Fixture Objects</a></div><div class="tocItem" style="margin-left:0px"><a href="#5. Pre & Post Processing">5. Pre & Post Processing</a></div><div class="tocItem" style="margin-left:0px"><a href="#6. Includes">6. Includes</a></div>
		</div>     
		<div id="content">
			<h1><a name="1. Introduction">1. Introduction</a></h1>The fixtures plugin allows you to use a convenient DSL to easily define a graph of persisted domain objects, typically for testing.<p class="paragraph"/>Here's an example…<p class="paragraph"/><div class="code"><pre>class MyTest <span class="java&#45;keyword">extends</span> GroovyTestCase &#123;<p class="paragraph"/>  def fixtureLoader<p class="paragraph"/>  void testGuillaumeAuthoredGina() &#123;<p class="paragraph"/>    def fixture = fixtureLoader.load &#123;
      guillaume(Author, name: <span class="java&#45;quote">"Guillaume Laforge"</span>)
      dierk(Author, name: <span class="java&#45;quote">"Dierk Koenig"</span>)
      gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>, authors: &#91;guillaume, dierk&#93;)
    &#125;<p class="paragraph"/>    assert fixture.guillaume in fixture.gina.authors<p class="paragraph"/>  &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>The equivalent without using fixtures would be…<p class="paragraph"/><div class="code"><pre>class MyTest <span class="java&#45;keyword">extends</span> GroovyTestCase &#123;<p class="paragraph"/>  void testGuillaumeAuthoredGina() &#123;<p class="paragraph"/>    def guillaume = <span class="java&#45;keyword">new</span> Author(name: <span class="java&#45;quote">"Guillaume Laforge"</span>)
    assert guillaume.save()
    def dierk = <span class="java&#45;keyword">new</span> Author(name: <span class="java&#45;quote">"Dierk Konig"</span>)
    assert dierk.save()
    def gina = <span class="java&#45;keyword">new</span> Book(title: <span class="java&#45;quote">"Groovy In Action"</span>)
    gina.addToAuthors(guillaume)
    gina.addToAuthors(dierk)
    assert gina.save()<p class="paragraph"/>    assert guillaume in gina.authors 
  &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>
<h3>Build-Test-Data integration</h3><p class="paragraph"/>A key feature of the plugin is the integration with the <a href="http://www.grails.org/plugin/build-test-data." target="blank">build-test-data plugin</a> This excellent plugin takes care of populating required domain properties that you don't care about for you, making your tests more focussed and readable.<p class="paragraph"/>If the build-test-data plugin is installed, you can use the <code>build()</code> method on the <code>fixtureLoader</code> to create your instances via the build-test-data's <code>build()</code> method thereby combining the DSL features of the fixtures plugin (i.e. expressing networks of objects) with the convenient instantiation features of build-test-data.<p class="paragraph"/>See the section on <a href="../guide/single.html#2.3 Build-Test-Data Integration" class="guide">build-test-data integration</a> for more info.
<h2><a name="1.1 How It Works">1.1 How It Works</a></h2>The plugin works by creating each fixture as a Spring application context via <a href="http://grails.org/doc/latest/guide/14.%20Grails%20and%20Spring.html#14.4%20The%20BeanBuilder%20DSL%20Explained" target="blank">Grails' own BeanBuilder</a> (i.e. it's the exact same DSL).<p class="paragraph"/>When you are defining a fixture, you are <em class="italic">declaring</em> an object graph just like a Spring XML file or in <code>resources.groovy</code> in a Grails application. Therefore, a fixture is a definition of an object graph and not the actual instantiation of the objects. Once the graph has been defined, the objects are instantiated and wired together. The fixtures plugin adds some smarts to this process to wire domain objects up appropriately using the <code>addTo*</code> GORM methods and to call the <code>save()</code> method where appropriate.<p class="paragraph"/>There are some extra features/functions that go beyond normal bean loading via Spring that you can learn about in this documentation.<h2><a name="1.2 Changelog">1.2 Changelog</a></h2><h4>0.5</h4>
<ul class="star">
<li>Loading of inline and file fixtures</li>
<li>Distribution of fixtures in the WAR</li>
</ul><p class="paragraph"/><h4>0.6</h4>
<ul class="star">
<li>Loading a fixture returns a Fixture object, which holds the loaded objects</li>
<li>Fixture files now use a <code>fixtures</code> closure, instead of the normal <code>beans</code> method</li>
</ul><p class="paragraph"/><h4>0.7</h4>
<ul class="star">
<li>Much improved support for bi-directional relationships</li>
<li>Improved error reporting when an object fails to save (due to constraint violations)</li>
</ul><p class="paragraph"/><h4>0.8</h4>
<ul class="star">
<li>Support for "partial" fixture files (i.e. being able to combine fixture files to create one fixture)</li>
<li>Improved support for one to many relationships</li>
</ul><p class="paragraph"/><h4>0.9</h4>
<ul class="star">
<li>Loaded objects are now autowired</li>
<li>The post processor now has extensive logging to help track down dependency issues</li>
<li>Support a post creation callback in fixture files via <code>post(Closure callback)</code></li>
<li>Support for loading fixture files via Ant path matching patterns</li>
<li>Support including fixture files inside fixture files</li>
<li>Support pre creation callback in fixture files via <code>pre(Closure callback)</code></li>
<li>Support for named fixtures</li>
</ul><p class="paragraph"/><h4>1.0</h4>
<ul class="star">
<li>Much improved error reporting</li>
<li>Improved post processing logging (each bean gets it's own log namespace)</li>
<li>Added support for <code>require()</code> checks in fixture files to ensure that a bean has been defined previously</li>
<li>Support for inner fixtures in files (i.e. loading multiple fixtures in one file)</li>
<li>pre/post processors can now access any application beans (including fixture beans in post)</li>
<li>Support for accessing bean instances in fixture definitions (e.g. for password encoding)</li>
<li>Smart handling of bi-directionals (either side can be set and the plugin will translate)</li>
<li>Introduced build-test-data plugin integration</li>
<li>Utilise Grails' 1.2's <code>failOnError</code> to give better error messages on failure</li>
<li>More fixes for complex bidirectional relationships</li>
</ul><p class="paragraph"/><h1><a name="2. Defining The Data">2. Defining The Data</a></h1>Fixture data is defined using a simple DSL that expresses objects, their properties and their relationships. This is the same DSL used by Grails' <a href=":http://grails.org/doc/latest/guide/14.%20Grails%20and%20Spring.html#14.4%20The%20BeanBuilder%20DSL%20Explained">Spring BeanBuilder</a> as underneath the covers a BeanBuilder is being used to create the fixture data.<p class="paragraph"/>See the section on <a href="../guide/single.html#3. Loading Fixtures" class="guide">loading data</a> for information on how to load these definitions.<p class="paragraph"/>Here is an overview of the DSL, focussing on features useful for fixture definition.<h2><a name="2.1 Basics">2.1 Basics</a></h2>A single object is defined as follows…<p class="paragraph"/><div class="code"><pre>gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>)</pre></div><p class="paragraph"/>This is defining an object named <code>gina</code>, of type <code>Book</code> with the <code>title</code> property set to <code>"Groovy In Action"</code>.<p class="paragraph"/>An alternative syntax is…<p class="paragraph"/><div class="code"><pre>gina(Book) &#123;
    title =  <span class="java&#45;quote">"Groovy In Action"</span>
&#125;</pre></div><p class="paragraph"/>These two syntaxes effectively achieve the same thing. The difference is that the first example is equivalent to…<p class="paragraph"/><div class="code"><pre>def gina = <span class="java&#45;keyword">new</span> Book(title: <span class="java&#45;quote">"Groovy In Action"</span>)</pre></div><p class="paragraph"/>While the second (alternative) syntax is equivalent to…<p class="paragraph"/><div class="code"><pre>def gina = <span class="java&#45;keyword">new</span> Book()
gina.title = <span class="java&#45;quote">"Groovy In Action"</span></pre></div><p class="paragraph"/>The two can even be mixed…<p class="paragraph"/><div class="code"><pre>gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>) &#123;
    isbn = <span class="java&#45;quote">"123456778"</span>
&#125;</pre></div><p class="paragraph"/><h4>Specifying Relationships</h4><p class="paragraph"/>A key benefit to using the fixtures plugin is that it makes specifying related objects simple and concise.<p class="paragraph"/>Consider the following GORM domain classes:<p class="paragraph"/><div class="code"><pre>class Author &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;
    <span class="java&#45;object">String</span> name
&#125;
class Book &#123;
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/>We can specify an Author/Book relationship like so…<p class="paragraph"/><div class="code"><pre>b(Book, title: <span class="java&#45;quote">"The Fellowship of the Ring"</span>)
a(Author, name: <span class="java&#45;quote">"J.R.R. Tolkien"</span>, books: &#91;b&#93;)</pre></div><p class="paragraph"/>In this example, <code>b</code> must be defined before it is referenced by <code>a</code>. To reference <code>b</code> before it is defined, the special <code>ref(«name»)</code> method can be used…<p class="paragraph"/><div class="code"><pre>a(Author, name: <span class="java&#45;quote">"J.R.R. Tolkien"</span>, books: &#91;ref(<span class="java&#45;quote">"b"</span>)&#93;)
b(Book, title: <span class="java&#45;quote">"The Fellowship of the Ring"</span>)</pre></div><p class="paragraph"/>If the relationship is bidirectional, it can be set on either side…<p class="paragraph"/><div class="code"><pre>a(Author, name: <span class="java&#45;quote">"J.R.R. Tolkien"</span>)
b(Book, title: <span class="java&#45;quote">"The Fellowship of the Ring"</span>, author: a)</pre></div><p class="paragraph"/><h2><a name="2.2 Advanced Techniques">2.2 Advanced Techniques</a></h2><h2><a name="2.3 Build-Test-Data Integration">2.3 Build-Test-Data Integration</a></h2><h1><a name="3. Loading Fixtures">3. Loading Fixtures</a></h1><h2><a name="3.1 Inline Fixtures">3.1 Inline Fixtures</a></h2><h2><a name="3.2 Fixture Files">3.2 Fixture Files</a></h2><h2><a name="3.3 Named Fixtures">3.3 Named Fixtures</a></h2><h1><a name="4. Fixture Objects">4. Fixture Objects</a></h1><h1><a name="5. Pre & Post Processing">5. Pre & Post Processing</a></h1><h1><a name="6. Includes">6. Includes</a></h1>         			
		</div>
		<div id="footer">
			  Developed by the <a href='http://gpc.github.com'>Grails Plugin Collective</a>
		</div>	
	</body>
</html>